{"version":3,"file":"beyond-translation.mjs","sources":["../../../projects/translation/src/lib/services/translation-registry.service.ts","../../../projects/translation/src/lib/services/translation.service.ts","../../../projects/translation/src/lib/services/lazy-translation.service.ts","../../../projects/translation/src/lib/services/translation.loader.ts","../../../projects/translation/src/lib/provider.ts","../../../projects/translation/src/public-api.ts","../../../projects/translation/src/beyond-translation.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\nimport { Observable, Subject } from 'rxjs';\n\nexport interface ITranslation {\n  id: string;\n  getTranslation(lang: string): Observable<object | null>;\n}\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class CamTranslationRegistryService {\n  registered: ITranslation[] = [];\n  newRegistrationSubscription$ = new Subject();\n\n  constructor() {}\n\n  public register(register: ITranslation) {\n    this.registered.push(register);\n    this.newRegistrationSubscription$.next(null);\n  }\n\n  public getTranslations(lang: string) {\n    return this.registered.map(r => r.getTranslation(lang));\n  }\n}\n","import { Inject, Injectable, Optional, inject } from '@angular/core';\n\nimport { TranslateService } from '@ngx-translate/core';\nimport { SessionStorage } from 'storage-manager-js';\n\nimport { CamTranslationRegistryService } from './translation-registry.service';\n\nexport const TRANSLATION_CONFIG = 'config_translation';\nexport interface ITranslationConfig {\n  default: string;\n  supportedLanguages: string[];\n}\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class CamTranslationService {\n  public translateService = inject(TranslateService);\n  private _registry = inject(CamTranslationRegistryService);\n\n  constructor(\n    @Optional()\n    @Inject(TRANSLATION_CONFIG)\n    private _config: ITranslationConfig = {\n      default: 'fr',\n      supportedLanguages: ['fr'],\n    }\n  ) {\n    this._registry.newRegistrationSubscription$.subscribe(() => {\n      // this._config.supportedLanguages.forEach(l => this.translateService.reloadLang(l));\n      this.translateService.reloadLang(this.translateService.currentLang);\n    });\n  }\n\n  public init(): void {\n    // this language will be used as a fallback when a translation isn't found in the current language\n    this.translateService.setDefaultLang(this._config.default);\n\n    // the lang to use, if the lang isn't available, it will use the current loader to get them\n    let lang: string = SessionStorage.get('lang') ?? this.translateService.getBrowserLang() ?? this._config.default;\n\n    if (!lang || !this._config.supportedLanguages.find(langId => langId === lang)) {\n      lang = this._config.default;\n    }\n    this.translateService.use(lang);\n\n    this.translateService.onLangChange.subscribe(({ lang }) => {\n      if (!SessionStorage.has('lang')) {\n        SessionStorage.set('lang', lang);\n        return;\n      }\n\n      if (lang === SessionStorage.get('lang')) {\n        return;\n      }\n\n      SessionStorage.set('lang', lang);\n      location.reload();\n    });\n  }\n\n  public getLanguage(): string {\n    return this.translateService.currentLang;\n  }\n\n  public get(key: string | string[], interpolateParams?: Object) {\n    return this.translateService.get(key, interpolateParams);\n  }\n\n  public use(lang: string) {\n    return this.translateService.use(lang);\n  }\n}\n","import { inject } from '@angular/core';\r\n\r\nimport { Observable, of } from 'rxjs';\r\n\r\nimport { CamTranslationRegistryService, ITranslation } from './translation-registry.service';\r\n\r\nexport abstract class CamLazyTranslationService implements ITranslation {\r\n  get id() {\r\n    return this._id;\r\n  }\r\n  private readonly _registry = inject(CamTranslationRegistryService);\r\n\r\n  private _id = '';\r\n  private _isApp = false;\r\n\r\n  constructor(id: string, isApp = false) {\r\n    this._id = id;\r\n    this._isApp = isApp;\r\n    this._registry.register(this);\r\n  }\r\n\r\n  static getInstance() {\r\n    return inject(this);\r\n  }\r\n\r\n  public getTranslation(lang: string): Observable<object | null> {\r\n    return of({});\r\n    // return this._strapiService.fetchQueryList$<Translation>(GET_TRANSLATIONS(lang, this._id), 'translations').pipe(\r\n    //   map(translations =>\r\n    //     translations.reduce<{ [index: string]: string }>((acc, translation) => {\r\n    //       acc[(this._isApp ? '' : this._id + '.') + translation.key] = translation.value;\r\n    //       return acc;\r\n    //     }, {})\r\n    //   ),\r\n    //   map(translations =>\r\n    //     Object.entries(translations).reduce((acc, [key, value]) => {\r\n    //       const keys = key.split('.');\r\n    //       keys.reduce<{ [index: string]: any }>((current, k, index) => {\r\n    //         if (index === keys.length - 1) {\r\n    //           current[k] = value;\r\n    //         } else {\r\n    //           current[k] = current[k] || {};\r\n    //         }\r\n    //         return current[k];\r\n    //       }, acc);\r\n\r\n    //       return acc;\r\n    //     }, {})\r\n    //   )\r\n    // );\r\n  }\r\n}\r\n","import { inject } from '@angular/core';\n\nimport { TranslateLoader } from '@ngx-translate/core';\nimport { Observable, forkJoin, map, tap } from 'rxjs';\n\nimport { CamTranslationRegistryService } from './translation-registry.service';\n\nexport class CamTranslationLoader implements TranslateLoader {\n  private registry = inject(CamTranslationRegistryService);\n  constructor() {}\n\n  getTranslation(lang: string): Observable<object> {\n    return forkJoin([...this.registry.getTranslations(lang)]).pipe(\n      map(translations =>\n        translations.reduce<object>((acc, translation) => {\n          if (!translation) {\n            return acc;\n          }\n          return this._merge(acc, translation);\n        }, {})\n      ),\n      tap(data => console.log('traduction', data))\n    );\n  }\n\n  private _merge(current: object, additionalTranslation: object): object {\n    return this._mergeDeep(current, additionalTranslation);\n  }\n\n  /**\n   * Simple object check.\n   * @param item Object\n   */\n  private _isObject(item: object | undefined): boolean {\n    return !!(item && typeof item === 'object' && !Array.isArray(item));\n  }\n\n  /**\n   * Deep merge two objects.\n   * @param target Object\n   * @param ...sources objects\n   */\n  private _mergeDeep(target: { [key: string]: any }, ...sources: { [key: string]: any }[]): { [key: string]: any } {\n    if (!sources.length) {\n      return target;\n    }\n    const source = sources.shift();\n    if (this._isObject(target) && this._isObject(source)) {\n      for (const key in source) {\n        if (this._isObject(source[key])) {\n          if (!target[key]) {\n            Object.assign(target, { [key]: {} });\n          }\n          this._mergeDeep(target[key], source[key]);\n        } else {\n          Object.assign(target, { [key]: source[key] });\n        }\n      }\n    }\n\n    return this._mergeDeep(target, ...sources);\n  }\n}\n","import { LOCALE_ID, Provider, inject, provideAppInitializer } from '@angular/core';\r\n\r\nimport { TranslateLoader, provideTranslateService } from '@ngx-translate/core';\r\n\r\nimport { CamTranslationLoader } from './services/translation.loader';\r\nimport { CamTranslationService, TRANSLATION_CONFIG } from './services/translation.service';\r\n\r\nexport function HttpLoaderFactory() {\r\n  return new CamTranslationLoader();\r\n}\r\n\r\nexport const provideTranslation = (data: { default: string; supportedLanguages: string[] }): Provider => [\r\n  provideTranslateService({\r\n    loader: {\r\n      provide: TranslateLoader,\r\n      useFactory: HttpLoaderFactory,\r\n    },\r\n  }),\r\n  {\r\n    provide: LOCALE_ID,\r\n    deps: [CamTranslationService],\r\n    useFactory: (TranslationService: CamTranslationService) => TranslationService.getLanguage(),\r\n  },\r\n  provideAppInitializer(() => {\r\n    const translationService = inject(CamTranslationService);\r\n    return translationService.init();\r\n  }),\r\n  {\r\n    provide: TRANSLATION_CONFIG,\r\n    useValue: {\r\n      default: data.default,\r\n      supportedLanguages: data.supportedLanguages,\r\n    },\r\n  },\r\n];\r\n","/*\n * Public API Surface of translation\n */\nexport { TranslateDirective, TranslatePipe } from '@ngx-translate/core';\n\nexport * from './lib/services/translation.service';\nexport * from './lib/services/translation-registry.service';\n\nexport * from './lib/services/lazy-translation.service';\n\nexport * from './lib/provider';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}